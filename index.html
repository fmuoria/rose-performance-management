<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quarterly Performance Scorecard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; margin: 0;}
    .container { max-width: 1200px; margin: 36px auto 36px auto; background: #fff; border-radius: 18px; box-shadow: 0 10px 32px rgba(80,60,120,0.15); padding: 0;}
    h1 { text-align: center; color: #2c3e50; margin-top: 0; padding: 32px 0 10px 0;}
    .tabs { display: flex; border-bottom: 2px solid #d1d5db; background: #f7f7fd;}
    .tab-btn { flex: 1; padding: 18px 0; text-align: center; border: none; background: none; font-size: 1.1rem; color: #6c6c96; cursor: pointer; font-weight: 600; transition: all .18s;}
    .tab-btn.active { color: #4b2994; background: #fff; border-bottom: 3px solid #667eea;}
    .tab-content { display: none; padding: 38px 38px 25px 38px;}
    .tab-content.active { display: block;}
    .info-row { display: flex; gap: 30px; margin-bottom: 22px; flex-wrap: wrap; }
    .info-col { flex: 1; min-width: 200px;}
    label { font-weight: bold; color: #444; }
    select, input[type="number"], textarea { font-size: 1rem; padding: 6px; width: 100%; border: 1.5px solid #e1e6ef; border-radius: 5px; background: #f8fafc; margin-top: 2px; }
    textarea { resize: vertical; min-height: 32px; max-height: 90px;}
    input[type="number"]:disabled, textarea:disabled { background: #f1f1f6; color: #999;}
    .btn-row { text-align: center; margin: 28px 0 8px 0;}
    button { background: linear-gradient(90deg, #667eea 70%, #764ba2 100%); color: #fff; font-weight: bold; font-size: 1rem; border: none; border-radius: 7px; padding: 12px 34px; margin: 7px 10px; cursor: pointer; box-shadow: 0 2px 8px rgba(80,60,120,0.10); transition: transform 0.08s;}
    button:active { transform: scale(0.97);}
    .scorecard-table { width: 100%; border-collapse: collapse; margin: 25px 0 10px 0; background: #fafafa;}
    .scorecard-table th, .scorecard-table td { border: 1px solid #d1d5db; padding: 10px 8px; font-size: 1rem; vertical-align: top;}
    .scorecard-table th { background: #f2f6fa; color: #34495e; font-weight: bold;}
    .scorecard-section-header { background: #667eea; color: #fff; font-size: 1.1rem; letter-spacing: 0.05em;}
    .section-total-row { background: #e4e8f8; font-weight: bold;}
    .final-total-row { background: #27ae60; color: #fff; font-weight: bold; font-size: 1.12rem;}
    .legend, .score-summary, .progress-box { margin: 25px 0 5px 0; padding: 15px 18px; border-radius: 10px; font-size: 1rem;}
    .legend { background: #fdf6e3; color: #856404;}
    .score-summary { background: #eafaf1; color: #1e824c; }
    .progress-box { background: #f4f7fb; color: #3a4765; }
    .progress-bar-wrap { background: #e8ecfd; border-radius: 7px; overflow: hidden; margin-top: 10px; height: 20px; width: 100%;}
    .progress-bar { background: linear-gradient(90deg,#27ae60 70%, #2ecc71 100%); height: 100%; transition: width 0.6s; color: #fff; line-height: 20px; font-weight: 600; text-align: center; font-size: 1rem;}
    .reports-table { width: 100%; border-collapse: collapse; background: #fafafa; margin-top: 20px;}
    .reports-table th, .reports-table td { border: 1px solid #d1d5db; padding: 10px 8px; font-size: 1rem; }
    .reports-table th { background: #f2f6fa; color: #34495e; }
    .dashboard-summary { margin: 14px 0 24px 0; background: #f6fefb; border-radius: 8px; padding: 18px 25px;}
    .dashboard-metric { margin: 8px 0; font-size: 1.1rem;}
    .dashboard-metric .label { color: #4b2994; font-weight: 600;}
    .dashboard-metric .value { color: #2c3e50; font-weight: 700;}
    .empty-msg { text-align:center; color:#8b8ba0; font-size:1.05rem; padding:32px 0;}
    .signin-bar { background: #f2f6fa; margin: 0; padding: 13px 30px; border-radius: 18px 18px 0 0; border-bottom: 1.5px solid #d1d5db; display: flex; align-items: center; justify-content: space-between;}
    .signin-bar .user { font-size: 1.08rem; color: #523b6a; }
    .signin-bar .signout-btn { background: #e33; color: #fff; font-weight: bold; border: none; border-radius: 6px; padding: 8px 18px; margin-left: 12px; cursor: pointer; }
    #g_id_signin { display:inline-block; vertical-align:middle;}
    @media (max-width: 900px) { .container { padding: 0; } .tab-content { padding: 18px 1vw 12px 1vw; } .info-row { flex-direction: column; gap: 10px;} }
    @media (max-width: 600px) { .tab-content { padding: 7px 0; } .scorecard-table th, .scorecard-table td, .reports-table th, .reports-table td { font-size: 0.93rem; } }
  </style>
</head>
<body>
<div class="container">
  <div class="signin-bar" id="signinBar">
    <div id="userStatus"></div>
    <div id="g_id_signin"></div>
  </div>
  <h1>Quarterly Performance Scorecard</h1>
  <div class="tabs">
    <button class="tab-btn active" onclick="showTab('scorecardTab', this)">Scorecard</button>
    <button class="tab-btn" onclick="showTab('reportsTab', this)">Reports</button>
    <button class="tab-btn" onclick="showTab('dashboardTab', this)">Dashboard</button>
  </div>
  <!-- SCORECARD TAB -->
  <div class="tab-content active" id="scorecardTab">
    <form id="scorecardForm" autocomplete="off">
      <div class="info-row">
        <div class="info-col">
          <label for="employeeName">Employee's Name:</label><br>
          <select id="employeeName" required>
            <option value="">Loading...</option>
          </select>
        </div>
        <div class="info-col">
          <label for="employeeJob">Job Title:</label><br>
          <select id="employeeJob" required>
            <option value="">Select Employee First</option>
          </select>
        </div>
        <div class="info-col">
          <label for="division">Division:</label><br>
          <select id="division" required>
            <option value="">Select Employee First</option>
          </select>
        </div>
        <div class="info-col">
          <label for="periodYear">Year:</label><br>
          <select id="periodYear">
            <option value="2025">2025</option>
          </select>
        </div>
        <div class="info-col">
          <label for="periodMonth">Month:</label><br>
          <select id="periodMonth" required>
            <option value="">Select</option>
            <option value="01">January</option>
            <option value="02">February</option>
            <option value="03">March</option>
            <option value="04">April</option>
            <option value="05">May</option>
            <option value="06">June</option>
            <option value="07">July</option>
            <option value="08">August</option>
            <option value="09">September</option>
            <option value="10">October</option>
            <option value="11">November</option>
            <option value="12">December</option>
          </select>
        </div>
        <div class="info-col">
          <label for="periodWeek">Week:</label><br>
          <select id="periodWeek" required>
            <option value="">Select</option>
            <option value="1">Week 1</option>
            <option value="2">Week 2</option>
            <option value="3">Week 3</option>
            <option value="4">Week 4</option>
            <option value="5">Week 5</option>
          </select>
        </div>
      </div>
      <div class="progress-box" id="progressBox" style="display:none;">
        <div id="progressText"></div>
        <div class="progress-bar-wrap" style="margin-bottom:8px;">
          <div class="progress-bar" id="progressBar" style="width:0%"></div>
        </div>
      </div>
      <div id="scorecardLockedMsg" style="display:none;" class="legend"></div>
      <table class="scorecard-table" id="scorecardTable">
        <thead>
          <tr>
            <th style="width: 20%;">Dimension</th>
            <th style="width: 24%;">Performance Measure</th>
            <th style="width: 15%;">Target</th>
            <th style="width: 18%;">Actual<br><span style="font-weight:normal;">(employee input)</span></th>
            <th style="width: 8%;">Rating<br>(1-5)</th>
            <th style="width: 7%;">Weight<br>(%)</th>
            <th style="width: 10%;">Weighted<br>Average</th>
            <th style="width: 20%;">Manager's Comments</th>
          </tr>
        </thead>
        <tbody id="scorecardBody"></tbody>
      </table>
      <div class="btn-row" id="scorecardBtns">
        <button type="button" onclick="saveScorecard()">Save</button>
        <button type="reset">Reset</button>
      </div>
    </form>
    <div class="score-summary" id="scoreSummary"></div>
    <div class="legend" id="scoreLegend">
      <b>Score Legend:</b><br>
      1.00–1.99 Not met;&nbsp; 2.00–2.99 Partially met;&nbsp; 3.00–3.99 Met;&nbsp; 4.00–4.99 Generally Exceeding;&nbsp; 5.00 Exceeded by far
    </div>
  </div>
  <!-- REPORTS TAB -->
  <div class="tab-content" id="reportsTab">
    <h2>Your Weekly Submissions</h2>
    <div id="reportsTableWrap"></div>
    <div id="viewReportModal" style="display:none;"></div>
  </div>
  <!-- DASHBOARD TAB -->
  <div class="tab-content" id="dashboardTab">
    <h2>Performance Dashboard</h2>
    <div id="dashboardWrap"></div>
  </div>
</div>
<script>
// === GOOGLE SIGN-IN LOGIC ===
let userProfile = null;
window.onload = function() {
  // Show Google Sign-In button
  window.handleCredentialResponse = (response) => {
    const data = parseJwt(response.credential);
    userProfile = {
      email: data.email,
      name: data.name,
      picture: data.picture
    };
    updateUserUI();
    initializeEmployeeDropdowns();
    renderScorecardRows();
    updateProgressBar();
    checkIfScorecardLocked();
  };
  google.accounts.id.initialize({
    client_id: "YOUR_GOOGLE_CLIENT_ID",
    callback: handleCredentialResponse
  });
  google.accounts.id.renderButton(
    document.getElementById("g_id_signin"),
    { theme: "outline", size: "large", width: 220 }
  );
  updateUserUI();
  renderScorecardRows();
  updateProgressBar();
  checkIfScorecardLocked();
};
function parseJwt(token) {
  // Parse a JWT token (Google Sign-In credential)
  const base64Url = token.split('.')[1];
  const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
  const jsonPayload = decodeURIComponent(
    atob(base64).split('').map(function(c) {
      return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join('')
  );
  return JSON.parse(jsonPayload);
}
function updateUserUI() {
  const userStatus = document.getElementById("userStatus");
  if (userProfile) {
    userStatus.innerHTML = `
      <span class="user">
        <img src="${userProfile.picture}" alt="User" style="width:34px;vertical-align:middle;border-radius:50%;margin-right:8px;">
        Welcome, <b>${userProfile.name}</b> (${userProfile.email})
      </span>
      <button class="signout-btn" onclick="signOut()">Sign out</button>
    `;
    document.getElementById("g_id_signin").style.display = "none";
    document.querySelectorAll('.tab-content, .tabs').forEach(el => el.style.display = "");
  } else {
    userStatus.innerHTML = `<span style="font-size:1.07rem;">Please sign in with your Google account to use the scorecard.</span>`;
    document.getElementById("g_id_signin").style.display = "";
    document.querySelectorAll('.tab-content, .tabs').forEach(el => el.style.display = "none");
  }
}
function signOut() {
  google.accounts.id.disableAutoSelect();
  userProfile = null;
  updateUserUI();
}
// === REST OF APP LOGIC (unchanged but now filter by userProfile.email for reports/dashboard/save) ===
// ... (Paste the rest of your app code here, replacing all localStorage filters by user email) ...
// For brevity, reuse the previous JS code, but make sure:
// - When saving a record, add `userEmail: userProfile.email`
// - When showing reports/dashboard, filter only for `userEmail: userProfile.email`
</script>
</body>
</html>
